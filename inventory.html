<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invent√°≈ô √öspƒõch≈Ø</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/inventory.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="inventory-page">

    <div class="page-wrapper">
        <header class="app-header">
            <img src="img/augview.png" alt="Logo AR Aplikace" id="app-logo">
            <h1>Invent√°≈ô √öspƒõch≈Ø</h1>
        </header>

        <main>
            <!-- Progress Overview -->
            <div class="progress-overview">
                <div class="progress-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="total-achievements">0</span>
                        <span class="stat-label">Celkem √∫spƒõch≈Ø</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="unlocked-achievements">0</span>
                        <span class="stat-label">Odemƒçeno</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="completion-percentage">0%</span>
                        <span class="stat-label">Dokonƒçeno</span>
                    </div>
                </div>
            </div>

            <!-- Category Filter -->
            <div class="category-filter">
                <button class="filter-btn active" data-category="all">V≈°echny</button>
                <button class="filter-btn" data-category="global">üåç Glob√°ln√≠</button>
                <button class="filter-btn" data-category="kyjov">üèõÔ∏è Kyjov</button>
                <button class="filter-btn" data-category="secret">üîç Skryt√©</button>
            </div>

            <!-- Achievements Grid -->
            <div class="achievements-container">
                <div id="achievements-grid" class="achievements-grid">
                    <!-- Achievements will be dynamically loaded here -->
                </div>
            </div>

            <!-- Back Button -->
            <div class="back-button-container">
                <a href="index.html" class="menu-button back-button">Zpƒõt na Menu</a>
            </div>
        </main>

        <footer class="app-footer">
            <p>¬© 2025 Vytvo≈ôil V√°clav Pƒõnƒç√≠k</p>
        </footer>
    </div>

    <!-- Achievement Detail Modal -->
    <div id="achievementModal" class="achievement-modal-overlay">
        <div class="achievement-modal-content">
            <span id="achievementModalCloseBtn" class="achievement-modal-close-button">√ó</span>
            <div class="achievement-detail">
                <div class="achievement-icon-large" id="modalAchievementIcon">üèÜ</div>
                <h2 id="modalAchievementName">N√°zev √∫spƒõchu</h2>
                <p id="modalAchievementDescription">Popis √∫spƒõchu</p>
                <div class="achievement-meta">
                    <span class="achievement-rarity" id="modalAchievementRarity">Bƒõ≈æn√Ω</span>
                    <span class="achievement-category" id="modalAchievementCategory">Kategorie</span>
                </div>
                <div class="achievement-unlock-date" id="modalUnlockDate" style="display: none;">
                    <small>Odemƒçeno: <span id="modalUnlockDateText"></span></small>
                </div>
            </div>
        </div>
    </div>

    <!-- Load scripts -->
    <script src="gamification-config.js"></script>
    <script src="gamification.js"></script>

    <script>
        // Main inventory script
        document.addEventListener('DOMContentLoaded', () => {
            initializeInventory();
            setupFilterButtons();
            setupModal();
        });

        function initializeInventory() {
            loadAchievements();
            updateProgressStats();
        }

        function loadAchievements(filterCategory = 'all') {
            const achievementsGrid = document.getElementById('achievements-grid');
            achievementsGrid.innerHTML = '';

            const unlockedAchievements = getUnlockedAchievements();
            const unlockedIds = unlockedAchievements.map(a => a.id);

            // Get all achievements based on filter
            let achievementsToShow = [];
            
            if (filterCategory === 'all') {
                achievementsToShow = Object.keys(ACHIEVEMENTS_CONFIG);
            } else {
                achievementsToShow = Object.keys(ACHIEVEMENTS_CONFIG).filter(id => 
                    ACHIEVEMENTS_CONFIG[id].category === filterCategory
                );
            }

            // Sort achievements: unlocked first, then by rarity
            achievementsToShow.sort((a, b) => {
                const aUnlocked = unlockedIds.includes(a);
                const bUnlocked = unlockedIds.includes(b);
                
                if (aUnlocked && !bUnlocked) return -1;
                if (!aUnlocked && bUnlocked) return 1;
                
                // If both same unlock status, sort by rarity
                const rarityOrder = { legendary: 0, rare: 1, uncommon: 2, common: 3 };
                const aRarity = rarityOrder[ACHIEVEMENTS_CONFIG[a].rarity] || 4;
                const bRarity = rarityOrder[ACHIEVEMENTS_CONFIG[b].rarity] || 4;
                
                return aRarity - bRarity;
            });

            achievementsToShow.forEach(achievementId => {
                const achievement = ACHIEVEMENTS_CONFIG[achievementId];
                const isUnlocked = unlockedIds.includes(achievementId);
                const isHidden = achievement.hidden && !isUnlocked;

                // Skip hidden achievements if not unlocked
                if (isHidden) return;

                const achievementElement = createAchievementElement(achievementId, achievement, isUnlocked);
                achievementsGrid.appendChild(achievementElement);
            });
        }

        function createAchievementElement(achievementId, achievement, isUnlocked) {
            const achievementDiv = document.createElement('div');
            achievementDiv.className = `achievement-item ${isUnlocked ? 'unlocked' : 'locked'}`;
            achievementDiv.dataset.achievementId = achievementId;
            achievementDiv.dataset.rarity = achievement.rarity;

            const rarityConfig = RARITY_CONFIG[achievement.rarity] || RARITY_CONFIG.common;
            
            if (isUnlocked && rarityConfig.glow !== 'none') {
                achievementDiv.style.boxShadow = rarityConfig.glow;
            }

            achievementDiv.innerHTML = `
                <div class="achievement-icon" style="color: ${rarityConfig.color}">
                    ${isUnlocked ? achievement.icon : 'üîí'}
                </div>
                <div class="achievement-info">
                    <h3 class="achievement-name">${isUnlocked ? achievement.name : '???'}</h3>
                    <p class="achievement-description">${isUnlocked ? achievement.description : 'Skryt√Ω √∫spƒõch'}</p>
                    <div class="achievement-meta">
                        <span class="achievement-rarity" style="color: ${rarityConfig.color}">
                            ${rarityConfig.name}
                        </span>
                        <span class="achievement-category">
                            ${ACHIEVEMENT_CATEGORIES[achievement.category]?.name || achievement.category}
                        </span>
                    </div>
                </div>
            `;

            if (isUnlocked) {
                achievementDiv.addEventListener('click', () => showAchievementDetail(achievementId));
            }

            return achievementDiv;
        }

        function updateProgressStats() {
            const totalAchievements = Object.keys(ACHIEVEMENTS_CONFIG).length;
            const unlockedAchievements = getUnlockedAchievements();
            const completionPercentage = Math.round((unlockedAchievements.length / totalAchievements) * 100);

            document.getElementById('total-achievements').textContent = totalAchievements;
            document.getElementById('unlocked-achievements').textContent = unlockedAchievements.length;
            document.getElementById('completion-percentage').textContent = `${completionPercentage}%`;
        }

        function setupFilterButtons() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // Add active class to clicked button
                    button.classList.add('active');
                    
                    // Filter achievements
                    const category = button.dataset.category;
                    loadAchievements(category);
                });
            });
        }

        function setupModal() {
            const modal = document.getElementById('achievementModal');
            const closeBtn = document.getElementById('achievementModalCloseBtn');

            closeBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (event) => {
                if (event.target === modal) {
                    closeModal();
                }
            });

            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && modal.classList.contains('visible')) {
                    closeModal();
                }
            });
        }

        function showAchievementDetail(achievementId) {
            const achievement = ACHIEVEMENTS_CONFIG[achievementId];
            const achievementData = getAchievementData();
            const unlockData = achievementData[achievementId];

            if (!achievement || !unlockData) return;

            const modal = document.getElementById('achievementModal');
            const rarityConfig = RARITY_CONFIG[achievement.rarity] || RARITY_CONFIG.common;

            document.getElementById('modalAchievementIcon').textContent = achievement.icon;
            document.getElementById('modalAchievementIcon').style.color = rarityConfig.color;
            document.getElementById('modalAchievementName').textContent = achievement.name;
            document.getElementById('modalAchievementDescription').textContent = achievement.description;
            document.getElementById('modalAchievementRarity').textContent = rarityConfig.name;
            document.getElementById('modalAchievementRarity').style.color = rarityConfig.color;
            document.getElementById('modalAchievementCategory').textContent = 
                ACHIEVEMENT_CATEGORIES[achievement.category]?.name || achievement.category;

            if (unlockData.unlockedAt) {
                const unlockDate = new Date(unlockData.unlockedAt);
                document.getElementById('modalUnlockDateText').textContent = 
                    unlockDate.toLocaleDateString('cs-CZ') + ' ' + unlockDate.toLocaleTimeString('cs-CZ');
                document.getElementById('modalUnlockDate').style.display = 'block';
            } else {
                document.getElementById('modalUnlockDate').style.display = 'none';
            }

            modal.classList.add('visible');
        }

        function closeModal() {
            const modal = document.getElementById('achievementModal');
            modal.classList.remove('visible');
        }

        // Listen for achievement unlocks (if user is on this page when achievement is unlocked)
        window.addEventListener('storage', (event) => {
            if (event.key === 'arAchievements') {
                updateProgressStats();
                // Reload current filter
                const activeFilter = document.querySelector('.filter-btn.active');
                if (activeFilter) {
                    loadAchievements(activeFilter.dataset.category);
                }
            }
        });
    </script>

    

</body>
</html>
